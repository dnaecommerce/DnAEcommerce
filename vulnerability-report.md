# Vulnerability Report: D&A Moon Plots

## Vulnerability: SQL Injection
	
### Description:

Sql Injection is a method of manipulating database information by injecting sql query strings into form data or other input on a website. This can be done to gain access to otherwise restricted areas of a site or to cause damage through modifying or deleting data.

### Solution:

We address this issue through the following methods:

* Binding on form inputs

    `public async Task<IActionResult> Receipt([Bind(Prefix = "ShippingDetails")]ShippingDetails sdvm)`

* Dependency injection

    `services.AddScoped<IBasketManager, BasketService>();`

* Repository design pattern with Entity Framework Core

    `public class ProductService : IProductManager`

### Resources:

1. [Entity Framework](https://docs.microsoft.com/en-us/ef/core/)
2. [Bound Parameters](https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-adtg/3dd7dca4-07d1-42f7-bfec-50dbfdb312ed)


## Weak Account Management

### Description:
Weak account management is a product of not checking to verify that data being sent from a “user” is accurate. For example if you store a token on the user data as the only form of verification and that token gets exposed to a man in the middle attack the account is now vulnerable.

### Solution:
We address this issue through the following methods:

* Identity Framework for User Register/Login

    ```
    private UserManager<User> _userManager;
	private SignInManager<User> _signInManager;
    ```

* Identity SigninManager maintains session data to ensure security

    `_signInManager.SignInAsync(user, isPersistent: false);`

### Resources:
1. [Identity](https://docs.microsoft.com/en-us/aspnet/core/security/authentication/identity?view=aspnetcore-2.2&tabs=visual-studio)


## Missing function-level access control

### Description:
Missing function level access control is an issue that causes sections of the site to become exposed to those who aren’t authorized. This will unintentionally expose important sensitive information to those who shouldn’t have access.

### Solution:
We address this issue through the following methods:

* Areas of the site are controlled through Member roles to provide authorization

    ```
    [Authorize(Roles = Roles.Admin)]
	public class DashboardModel : PageModel
    ```

### Resources:
1. [Role-Based Authorization](https://docs.microsoft.com/en-us/aspnet/core/security/authorization/roles?view=aspnetcore-2.2)


## Sensitive Data Exposure

### Description:
This is a vulnerability where sensitive data such as passwords get exposed to users. This often times occurs when passwords are stored in some form before hashing making it easier to obtain user information or access to the site for malicious purposes.

### Solution:
We address this issue through the following methods:

* Passwords are only stored post hash and are never stored outside Identity Database

    ```
    if (NewPass.Equals(ConfirmPass))
	{
	    await _userManager.ChangePasswordAsync(AppUser, OldPass, NewPass);
	    return RedirectToPage();
	}
    ```

* Passwords required to meet industry standards

    `[StringLength(16, ErrorMessage = "The {0} must be between {2} and {1} characters long", MinimumLength = 6)]`

### Resources:
1. [Identity](https://docs.microsoft.com/en-us/aspnet/core/security/authentication/identity?view=aspnetcore-2.2&tabs=visual-studio)
